#
# tests/Makefile.am
#
# For the license, see the LICENSE file in the root directory.
#

check_PROGRAMS =

TESTS = \
	test_vtpm_proxy \
	test_tpm2_vtpm_proxy

if WITH_CHARDEV
TESTS += \
	test_ctrlchannel2 \
	test_ctrlchannel4
endif

TESTS += \
	test_ctrlchannel \
	test_ctrlchannel3 \
	test_encrypted_state \
	test_getcap \
	test_hashing \
	test_hashing2 \
	test_init \
	test_locality \
	test_migration_key \
	test_resume_volatile \
	test_save_load_encrypted_state \
	test_save_load_state \
	test_volatilestate \
	test_swtpm_bios \
	test_tpm_probe \
	test_wrongorder

TESTS += \
	test_tpm2_init \
	test_tpm2_getcap \
	test_tpm2_locality \
	test_tpm2_hashing \
	test_tpm2_hashing2 \
	test_tpm2_hashing3 \
	test_tpm2_savestate \
	test_tpm2_save_load_state_3 \
	test_tpm2_wrongorder \
	test_tpm2_probe \
	\
	test_tpm2_swtpm_bios

if WITH_SWTPM_SETUP
TESTS += \
	test_commandline \
	test_parameters \
	\
	test_tpm2_parameters
endif

if WITH_GNUTLS
TESTS += \
	test_swtpm_cert \
	test_tpm2_swtpm_cert \
	test_tpm2_swtpm_cert_ecc
if WITH_SWTPM_SETUP
TESTS += \
	test_swtpm_setup_create_cert \
	test_tpm2_swtpm_setup_create_cert
endif
endif

EXTRA_DIST=$(TESTS) \
	swtpm_setup.conf \
	create_certs.sh \
	data/issuercert.pem \
	data/pubek.pem \
	data/signkey.pem \
	data/keyfile.txt \
	data/pwdfile.txt \
	data/migkey1/volatilestate.bin \
	data/tpmstate1/tpm-00.permall \
	data/tpmstate1/tpm-00.volatilestate \
	data/tpmstate1/README \
	data/tpmstate2/tpm-00.permall \
	data/tpmstate2/tpm-00.volatilestate \
	data/tpmstate2/pwdfile.txt \
	data/tpmstate2/README \
	test_common \
	test_cuse \
	test_swtpm_cert

check-display:
	@if test -n "$$SWTPM_EXE"; then \
		echo "*** Using SWTPM_EXE=$$SWTPM_EXE"; \
	fi
	@if test -n "$$SWTPM_BIOS"; then \
		echo "*** Using SWTPM_BIOS=$$SWTPM_BIOS"; \
	fi
	@if test -n "$$SWTPM_IOCTL"; then \
		echo "*** Using SWTPM_IOCTL=$$SWTPM_IOCTL"; \
	fi

check: check-am check-display
